---
import type { GetStaticPaths } from "astro";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";

import Layout from "@common/Layout.astro";
import { BackButton } from "@common/BackButton";
import Chip from "@common/Chip.astro";
import type { Category } from "@common/Chip.astro";
import Button from "@common/Button.astro";

export const getStaticPaths = (async () => {
  const projects = await getCollection("projects");

  return projects.map((project) => ({
    params: { slug: project.slug },
    props: project,
  }));
}) satisfies GetStaticPaths;

const project = Astro.props;
const { cover, title, description, categories, icons, href } = project.data;
const { Content } = await project.render();
---

<Layout title={title} description={description} headerTitle="Mis proyectos">
  <section
    class="w-full m-auto px-2 xl:w-[1024px] py-24 flex flex-col items-center"
  >
    <BackButton client:load>
      <Icon name="mdi:arrow-u-left-top" class="min-w-6" />
    </BackButton>
    <main class="prose m-auto" transition:name={title}>
      <Image src={cover} alt={title} class="w-full object-cover rounded-lg" />
      <div class="w-full md:w-2/3 mx-auto flex flex-col items-center">
        <div class="flex gap-1">
          {categories.map((category: Category) => <Chip category={category} />)}
        </div>
        <h1 class="my-4 text-center">{title}</h1>
        <div class="mb-4 flex gap-2">
          {
            icons.map((icon) => (
              <Icon name={icon} class="text-light-gray text-2xl" />
            ))
          }
        </div>
        <p class="text-center text-balanced">{description}</p>
        <hr class="w-full my-4" />
        <Content />
        <hr class="w-full mt-4 mb-8" />
      </div>
    </main>
    <Button type="text" name="Ver Proyecto" href={href} target="_blank">
      <Icon name="mdi:external-link" class="text-white min-w-6" />
      <span class="btn-label">Ver proyecto</span>
    </Button>
  </section>
</Layout>
